import sys
if "../../Common" not in sys.path: sys.path.append("../../Common") # Desperation

import datetime as dt
from decimal import Decimal
from book_base import BookBase

class Book(BookBase):
    '''
    Store orders as a dictionary of prices. Each price has one size (no orderID's)
    Price published to 2 deimal places. Have to wait for snapshot in srtream before proceeding.
    '''
    def __init__(self, product):
        BookBase.__init__(self, product)
        
    def doSnapShot(self, bids, asks):
        # convert to Decimal
        self._bids = { Decimal(data['price']) : {-1 : Decimal(data['size'])} for data in bids}
        self._asks = { Decimal(data['price']) : {-1 : Decimal(data['size'])} for data in asks}
        self.findBestBidAsk('buy')
        self.findBestBidAsk('sell')
        self.isGood()
        
    def doUpdateBook(self, side, dataList):
        
        queue = self._bids if side == 'buy' else self._asks
        
        for data in dataList:
            price = Decimal(data['price'])
            size = Decimal(data['size'])
        
            if (size == Decimal(0)):
                # Remove order
                if price in queue:
                    del queue[price]
                    self.findBestBidAsk(side)
                else:
                    print('ERROR: Expect price {} in dictionary to delete'.format(price))
            else:
                queue[price] = {-1 : size}
                
        self.findBestBidAsk(side)
        self.isGood()
            
    def doUpdateTrade(self, trades):
        for data in trades:
            self.setTradePriceSize(Decimal(data['price']), Decimal(data['size']))
            
def main():
    book = Book('USDT_BTC')
    
    bids = [{'size': 30, 'price': '98'}, {'size': 20, 'price': '100'}, {'size': 10, 'price': '99'}]
    asks = [{'size': 20, 'price': '102'}, {'size': 10, 'price': '101'}, {'size': 30, 'price': '103'}]
    
    book.doSnapShot(bids, asks)
    
    print(('Best Bid/Ask Expect (100,101). {} {}'.format(book._bestBidPrice, book._bestAskPrice)))
    book.printBestBidAsk('Expect (20@100 10@101)') 
        
    bid1 = Decimal(100.5)
    bid2 = Decimal(100)
    ask1 = Decimal(100.6)
    ask2 = Decimal(101)
    
    sz0 = Decimal(0)
    sz1 = Decimal(1)
    sz2 = Decimal(2)
    
    #bids
    book.doUpdateBook('buy', [{'price':bid1, 'size':sz1}])    #add better bid
    book.doUpdateBook('buy', [{'price':bid2, 'size':sz2}])
    book.printBestBidAsk('Expect (1@100.5 10@101)') 
    book.doUpdateBook('buy', [{'price':bid1, 'size':sz0}])    #remove best bid
    book.printBestBidAsk('Expect (2@100 10@101)') 
    
    #asks
    book.doUpdateBook('sell', [{'price':ask1, 'size':sz1}])    #add better ask
    book.doUpdateBook('sell', [{'price':ask2, 'size':sz2}])
    book.printBestBidAsk('Expect (2@100 1@100.6)') 
    book.doUpdateBook('sell', [{'price':ask1, 'size':sz0}])    #remove best ask
    book.printBestBidAsk('Expect (2@100 2@101)  ') 
    
    #remore all bids
    book.doUpdateBook('buy', [{'price':bid2, 'size':sz0}]) 
    book.doUpdateBook('buy', [{'price':Decimal(98), 'size':sz0}]) 
    book.doUpdateBook('buy', [{'price':Decimal(99), 'size':sz0}]) 
    book.printBestBidAsk('Expect (One side is empty)') 

if __name__ == '__main__':
    main()
    
#2017-09-15 14:15:19.951243 : {'MarketDataIncrementalRefresh': {'ask': [], 'trade': [], 'symbol': 'BCCETH', 'exchangeStatus': 'working', 'timestamp': 1505502919337, 'seqNo': 3134712, 'bid': [{'size': 100, 'price': '1.653540'}]}}
#2017-09-15 14:15:20.255243 : {'MarketDataSnapshotFullRefresh': {'symbol': 'BTCUSD', 'exchangeStatus': 'working', 'timestamp': 1505502919611, 'ask': [{'size': 2, 'price': '3658.37'}, {'size': 7, 'price': '3658.39'}, {'size': 2, 'price': '3659.77'}, {'size': 50, 'price': '3659.78'}, {'size': 3, 'price': '3662.22'}, {'size': 4, 'price': '3667.81'}, {'size': 39, 'price': '3668.99'}, {'size': 3, 'price': '3673.91'}, {'size': 12, 'price': '3676.29'}, {'size': 3, 'price': '3676.43'}, {'size': 20, 'price': '3676.84'}, {'size': 16, 'price': '3676.90'}, {'size': 6, 'price': '3677.19'}, {'size': 36, 'price': '3678.75'}, {'size': 140, 'price': '3678.78'}, {'size': 3, 'price': '3681.81'}, {'size': 287, 'price': '3684.00'}, {'size': 200, 'price': '3686.55'}, {'size': 220, 'price': '3687.00'}, {'size': 5, 'price': '3689.09'}, {'size': 10, 'price': '3694.58'}, {'size': 4, 'price': '3696.23'}, {'size': 2, 'price': '3700.00'}, {'size': 152, 'price': '3703.90'}, {'size': 4, 'price': '3706.38'}, {'size': 500, 'price': '3706.40'}, {'size': 45, 'price': '3712.87'}, {'size': 5, 'price': '3717.25'}, {'size': 5, 'price': '3720.00'}, {'size': 5, 'price': '3724.51'}, {'size': 1, 'price': '3724.72'}, {'size': 3, 'price': '3725.00'}, {'size': 5, 'price': '3725.48'}, {'size': 14, 'price': '3731.16'}, {'size': 5, 'price': '3733.03'}, {'size': 6, 'price': '3746.27'}, {'size': 28, 'price': '3749.96'}, {'size': 5, 'price': '3753.57'}, {'size': 6, 'price': '3760.86'}, {'size': 12, 'price': '3767.74'}, {'size': 7, 'price': '3768.12'}, {'size': 7, 'price': '3770.97'}, {'size': 3, 'price': '3785.00'}, {'size': 8, 'price': '3786.28'}, {'size': 10, 'price': '3789.97'}, {'size': 8, 'price': '3792.09'}, {'size': 3, 'price': '3800.00'}, {'size': 11, 'price': '3804.53'}, {'size': 11, 'price': '3811.82'}, {'size': 11, 'price': '3812.82'}, {'size': 16, 'price': '3821.50'}, {'size': 1, 'price': '3824.00'}, {'size': 13, 'price': '3826.40'}, {'size': 20, 'price': '3840.99'}, {'size': 33, 'price': '3843.39'}, {'size': 28, 'price': '3848.28'}, {'size': 45, 'price': '3856.49'}, {'size': 95, 'price': '3863.77'}, {'size': 24, 'price': '3866.14'}, {'size': 1, 'price': '3866.43'}, {'size': 1, 'price': '3868.00'}, {'size': 1, 'price': '3900.00'}, {'size': 49, 'price': '3980.00'}, {'size': 226, 'price': '3982.76'}, {'size': 22003, 'price': '4000.00'}, {'size': 620, 'price': '4002.87'}, {'size': 991, 'price': '4009.66'}, {'size': 666, 'price': '4016.85'}, {'size': 272, 'price': '4017.39'}, {'size': 964, 'price': '4022.35'}, {'size': 506, 'price': '4024.66'}, {'size': 992, 'price': '4032.41'}, {'size': 5530, 'price': '4035.60'}, {'size': 57, 'price': '4038.72'}, {'size': 201, 'price': '4039.79'}, {'size': 907, 'price': '4042.05'}, {'size': 5049, 'price': '4044.00'}, {'size': 1, 'price': '4050.00'}, {'size': 1318, 'price': '4052.08'}, {'size': 10, 'price': '4054.13'}, {'size': 1239, 'price': '4057.33'}, {'size': 354, 'price': '4062.15'}, {'size': 90, 'price': '4063.31'}, {'size': 3574, 'price': '4063.79'}, {'size': 80, 'price': '4065.60'}, {'size': 197, 'price': '4075.23'}, {'size': 50, 'price': '4085.66'}, {'size': 1293, 'price': '4087.63'}, {'size': 1047, 'price': '4089.20'}, {'size': 2196, 'price': '4090.74'}, {'size': 222, 'price': '4091.22'}, {'size': 556, 'price': '4091.50'}, {'size': 1326, 'price': '4092.83'}, {'size': 149, 'price': '4096.46'}, {'size': 3, 'price': '4100.00'}, {'size': 362, 'price': '4100.53'}, {'size': 174, 'price': '4111.73'}, {'size': 82, 'price': '4112.71'}, {'size': 79, 'price': '4112.98'}, {'size': 86, 'price': '4117.55'}, {'size': 32, 'price': '4120.03'}, {'size': 546, 'price': '4121.63'}, {'size': 158, 'price': '4124.42'}, {'size': 50, 'price': '4125.29'}, {'size': 95, 'price': '4127.17'}, {'size': 64, 'price': '4127.79'}, {'size': 59, 'price': '4129.59'}, {'size': 2305, 'price': '4131.54'}, {'size': 726, 'price': '4135.59'}, {'size': 2146, 'price': '4136.08'}, {'size': 799, 'price': '4136.64'}, {'size': 146, 'price': '4136.97'}, {'size': 3913, 'price': '4137.65'}, {'size': 101, 'price': '4138.94'}, {'size': 126, 'price': '4139.91'}, {'size': 650, 'price': '4140.52'}, {'size': 731, 'price': '4142.55'}, {'size': 1370, 'price': '4145.70'}, {'size': 456, 'price': '4146.33'}, {'size': 5579, 'price': '4147.29'}, {'size': 82, 'price': '4150.14'}, {'size': 79, 'price': '4150.67'}, {'size': 1373, 'price': '4155.89'}, {'size': 297, 'price': '4155.93'}, {'size': 4866, 'price': '4158.65'}, {'size': 2785, 'price': '4161.04'}, {'size': 414, 'price': '4164.38'}, {'size': 653, 'price': '4166.19'}, {'size': 500, 'price': '4171.90'}, {'size': 3423, 'price': '4174.60'}, {'size': 171, 'price': '4182.55'}, {'size': 175, 'price': '4184.35'}, {'size': 324, 'price': '4185.35'}, {'size': 155, 'price': '4185.69'}, {'size': 193, 'price': '4186.24'}, {'size': 598, 'price': '4186.75'}, {'size': 884, 'price': '4190.07'}, {'size': 51, 'price': '4193.20'}, {'size': 191, 'price': '4198.96'}, {'size': 1158, 'price': '4199.32'}, {'size': 1, 'price': '4199.99'}, {'size': 2, 'price': '4200.00'}, {'size': 54, 'price': '4203.14'}, {'size': 2417, 'price': '4204.48'}, {'size': 134, 'price': '4209.08'}, {'size': 941, 'price': '4210.47'}, {'size': 6443, 'price': '4210.66'}, {'size': 798, 'price': '4213.96'}, {'size': 3158, 'price': '4218.68'}, {'size': 500, 'price': '4219.48'}, {'size': 386, 'price': '4220.32'}, {'size': 105, 'price': '4222.46'}, {'size': 1368, 'price': '4223.04'}, {'size': 141, 'price': '4223.52'}, {'size': 171, 'price': '4223.79'}, {'size': 15, 'price': '4224.18'}, {'size': 601, 'price': '4226.27'}, {'size': 1, 'price': '4231.00'}, {'size': 338, 'price': '4237.21'}, {'size': 49, 'price': '4237.45'}, {'size': 27, 'price': '4244.99'}, {'size': 100, 'price': '4248.00'}, {'size': 2519, 'price': '4250.79'}, {'size': 103, 'price': '4250.98'}, {'size': 1886, 'price': '4254.86'}, {'size': 1203, 'price': '4259.03'}, {'size': 1271, 'price': '4260.35'}, {'size': 4158, 'price': '4260.46'}, {'size': 551, 'price': '4260.96'}, {'size': 1159, 'price': '4266.92'}, {'size': 151, 'price': '4269.98'}, {'size': 54, 'price': '4270.73'}, {'size': 1104, 'price': '4272.42'}, {'size': 2819, 'price': '4272.88'}, {'size': 8746, 'price': '4275.04'}, {'size': 129, 'price': '4276.78'}, {'size': 500, 'price': '4279.74'}, {'size': 475, 'price': '4281.25'}, {'size': 379, 'price': '4288.89'}, {'size': 1625, 'price': '4290.03'}, {'size': 710, 'price': '4290.95'}, {'size': 218, 'price': '4291.63'}, {'size': 1314, 'price': '4293.39'}, {'size': 401, 'price': '4294.79'}, {'size': 1444, 'price': '4295.48'}, {'size': 292, 'price': '4297.57'}, {'size': 1, 'price': '4300.00'}, {'size': 1, 'price': '4300.77'}, {'size': 91, 'price': '4302.29'}, {'size': 1030, 'price': '4304.46'}, {'size': 1596, 'price': '4305.21'}, {'size': 80, 'price': '4305.98'}, {'size': 5296, 'price': '4309.23'}, {'size': 2253, 'price': '4311.68'}, {'size': 209, 'price': '4314.26'}, {'size': 308, 'price': '4315.12'}, {'size': 157, 'price': '4317.61'}, {'size': 2058, 'price': '4322.38'}, {'size': 579, 'price': '4323.37'}, {'size': 576, 'price': '4325.32'}, {'size': 1573, 'price': '4327.48'}, {'size': 11, 'price': '4328.65'}, {'size': 1376, 'price': '4329.85'}, {'size': 1710, 'price': '4331.56'}, {'size': 201, 'price': '4338.02'}, {'size': 17, 'price': '4343.00'}, {'size': 381, 'price': '4350.00'}, {'size': 114, 'price': '4350.49'}, {'size': 500, 'price': '4352.70'}, {'size': 337, 'price': '4354.40'}, {'size': 2418, 'price': '4357.34'}, {'size': 2989, 'price': '4358.74'}, {'size': 1201, 'price': '4364.24'}, {'size': 8, 'price': '4371.01'}, {'size': 1, 'price': '4375.00'}, {'size': 1, 'price': '4378.94'}, {'size': 21, 'price': '4400.00'}, {'size': 3831, 'price': '4414.28'}, {'size': 3092, 'price': '4415.89'}, {'size': 223, 'price': '4435.18'}, {'size': 6, 'price': '4444.00'}, {'size': 2946, 'price': '4449.65'}, {'size': 194, 'price': '4449.95'}, {'size': 2106, 'price': '4450.87'}, {'size': 4226, 'price': '4459.61'}, {'size': 1446, 'price': '4459.94'}, {'size': 1788, 'price': '4465.00'}, {'size': 102, 'price': '4481.14'}, {'size': 25, 'price': '4500.00'}, {'size': 6490, 'price': '4513.37'}, {'size': 6243, 'price': '4517.07'}, {'size': 1011, 'price': '4518.05'}, {'size': 1856, 'price': '4541.11'}, {'size': 6626, 'price': '4546.09'}, {'size': 1, 'price': '4550.00'}, {'size': 2, 'price': '4561.50'}, {'size': 7, 'price': '4568.61'}, {'size': 1649, 'price': '4574.65'}, {'size': 50, 'price': '4582.01'}, {'size': 100, 'price': '4582.81'}, {'size': 3653, 'price': '4587.03'}, {'size': 49, 'price': '4592.02'}, {'size': 8, 'price': '4592.32'}, {'size': 20, 'price': '4600.00'}, {'size': 2266, 'price': '4608.74'}, {'size': 9, 'price': '4622.00'}, {'size': 1, 'price': '4630.93'}, {'size': 1, 'price': '4635.40'}, {'size': 1, 'price': '4635.76'}, {'size': 674, 'price': '4645.44'}, {'size': 3844, 'price': '4651.96'}, {'size': 3, 'price': '4656.00'}, {'size': 1, 'price': '4660.52'}, {'size': 1660, 'price': '4664.85'}, {'size': 1, 'price': '4665.93'}, {'size': 5, 'price': '4680.00'}, {'size': 500, 'price': '4684.62'}, {'size': 74, 'price': '4692.79'}, {'size': 200, 'price': '4694.77'}, {'size': 4, 'price': '4700.00'}, {'size': 1, 'price': '4700.69'}, {'size': 1, 'price': '4708.19'}, {'size': 245, 'price': '4730.14'}, {'size': 2591, 'price': '4737.26'}, {'size': 5110, 'price': '4737.35'}, {'size': 176, 'price': '4743.78'}, {'size': 5, 'price': '4755.00'}, {'size': 769, 'price': '4758.75'}, {'size': 1, 'price': '4771.35'}, {'size': 1077, 'price': '4776.39'}, {'size': 1, 'price': '4789.00'}, {'size': 44, 'price': '4800.00'}, {'size': 1, 'price': '4818.48'}, {'size': 2766, 'price': '4822.13'}, {'size': 53, 'price': '4831.25'}, {'size': 978, 'price': '4833.69'}, {'size': 4567, 'price': '4835.51'}, {'size': 345, 'price': '4837.44'}, {'size': 5974, 'price': '4839.71'}, {'size': 1, 'price': '4840.00'}, {'size': 4906, 'price': '4855.01'}, {'size': 4233, 'price': '4855.34'}, {'size': 2220, 'price': '4857.68'}, {'size': 3636, 'price': '4871.80'}, {'size': 4, 'price': '4875.00'}, {'size': 2, 'price': '4890.00'}, {'size': 5938, 'price': '4891.32'}, {'size': 9, 'price': '4900.00'}, {'size': 4688, 'price': '4914.37'}, {'size': 658, 'price': '4921.89'}, {'size': 3044, 'price': '4923.02'}, {'size': 409, 'price': '4923.89'}, {'size': 300, 'price': '4932.90'}, {'size': 3140, 'price': '4940.82'}, {'size': 2, 'price': '4950.00'}, {'size': 2292, 'price': '4957.05'}, {'size': 1790, 'price': '4960.49'}, {'size': 2372, 'price': '4960.84'}, {'size': 3957, 'price': '4962.56'}, {'size': 1793, 'price': '4972.66'}, {'size': 37, 'price': '4977.77'}, {'size': 134, 'price': '4981.00'}, {'size': 1, 'price': '4989.00'}, {'size': 48, 'price': '4999.00'}, {'size': 1, 'price': '4999.95'}, {'size': 1592, 'price': '5000.00'}, {'size': 1, 'price': '5000.51'}, {'size': 2, 'price': '5005.00'}, {'size': 143, 'price': '5010.27'}, {'size': 102, 'price': '5027.87'}, {'size': 8615, 'price': '5038.30'}, {'size': 1048, 'price': '5061.38'}, {'size': 105, 'price': '5085.97'}, {'size': 71, 'price': '5100.00'}, {'size': 583, 'price': '5181.87'}, {'size': 3, 'price': '5200.00'}, {'size': 556, 'price': '5239.66'}, {'size': 1, 'price': '5289.00'}, {'size': 770, 'price': '5407.45'}, {'size': 128, 'price': '5529.64'}, {'size': 2620, 'price': '5618.01'}, {'size': 1, 'price': '5690.00'}, {'size': 1743, 'price': '5756.80'}, {'size': 201, 'price': '5850.51'}, {'size': 1500, 'price': '6000.00'}, {'size': 1276, 'price': '6030.48'}, {'size': 100, 'price': '6218.60'}, {'size': 739, 'price': '6304.33'}, {'size': 6367, 'price': '6417.44'}, {'size': 4583, 'price': '6603.66'}, {'size': 3748, 'price': '6722.40'}, {'size': 11, 'price': '6820.00'}, {'size': 1, 'price': '7500.00'}, {'size': 1, 'price': '8000.00'}, {'size': 1500, 'price': '9000.00'}, {'size': 1, 'price': '10000.00'}, {'size': 11, 'price': '10810.76'}], 'snapshotSeqNo': 2867181, 'bid': [{'size': 2, 'price': '3644.14'}, {'size': 2, 'price': '3644.11'}, {'size': 43, 'price': '3644.10'}, {'size': 2, 'price': '3643.01'}, {'size': 130, 'price': '3642.00'}, {'size': 25, 'price': '3639.11'}, {'size': 261, 'price': '3639.10'}, {'size': 20, 'price': '3636.56'}, {'size': 3, 'price': '3635.26'}, {'size': 220, 'price': '3635.15'}, {'size': 270, 'price': '3635.00'}, {'size': 200, 'price': '3630.72'}, {'size': 330, 'price': '3625.80'}, {'size': 420, 'price': '3625.10'}, {'size': 4, 'price': '3625.00'}, {'size': 11, 'price': '3624.85'}, {'size': 3, 'price': '3623.99'}, {'size': 3, 'price': '3617.48'}, {'size': 313, 'price': '3616.80'}, {'size': 133, 'price': '3616.10'}, {'size': 500, 'price': '3612.23'}, {'size': 12, 'price': '3604.99'}, {'size': 3, 'price': '3604.50'}, {'size': 1, 'price': '3600.77'}, {'size': 4, 'price': '3598.29'}, {'size': 621, 'price': '3596.80'}, {'size': 4, 'price': '3594.13'}, {'size': 2, 'price': '3594.11'}, {'size': 2, 'price': '3593.44'}, {'size': 2, 'price': '3592.94'}, {'size': 430, 'price': '3591.80'}, {'size': 43, 'price': '3587.00'}, {'size': 53, 'price': '3586.84'}, {'size': 630, 'price': '3586.80'}, {'size': 5, 'price': '3582.81'}, {'size': 1364, 'price': '3581.22'}, {'size': 4, 'price': '3575.43'}, {'size': 15, 'price': '3568.77'}, {'size': 5, 'price': '3568.13'}, {'size': 650, 'price': '3566.80'}, {'size': 830, 'price': '3562.61'}, {'size': 5, 'price': '3552.94'}, {'size': 9, 'price': '3552.28'}, {'size': 16, 'price': '3550.59'}, {'size': 300, 'price': '3550.00'}, {'size': 5, 'price': '3546.37'}, {'size': 364, 'price': '3542.19'}, {'size': 5, 'price': '3534.74'}, {'size': 73, 'price': '3530.91'}, {'size': 6, 'price': '3523.79'}, {'size': 7, 'price': '3516.53'}, {'size': 6, 'price': '3516.52'}, {'size': 2, 'price': '3515.68'}, {'size': 7, 'price': '3510.68'}, {'size': 7, 'price': '3501.97'}, {'size': 1, 'price': '3500.00'}, {'size': 6, 'price': '3499.52'}, {'size': 10, 'price': '3492.89'}, {'size': 9, 'price': '3487.86'}, {'size': 5, 'price': '3485.54'}, {'size': 9, 'price': '3479.96'}, {'size': 9, 'price': '3475.00'}, {'size': 10, 'price': '3469.28'}, {'size': 13, 'price': '3465.57'}, {'size': 121, 'price': '3462.00'}, {'size': 16, 'price': '3458.69'}, {'size': 1, 'price': '3457.99'}, {'size': 16, 'price': '3452.65'}, {'size': 21, 'price': '3451.40'}, {'size': 26, 'price': '3444.10'}, {'size': 32, 'price': '3429.17'}, {'size': 55, 'price': '3422.00'}, {'size': 50, 'price': '3421.89'}, {'size': 94, 'price': '3414.62'}, {'size': 98, 'price': '3400.00'}, {'size': 60, 'price': '3385.70'}, {'size': 47, 'price': '3355.91'}, {'size': 2, 'price': '3300.00'}, {'size': 1, 'price': '3294.50'}, {'size': 30, 'price': '3293.97'}, {'size': 24, 'price': '3275.75'}, {'size': 704, 'price': '3275.16'}, {'size': 1222, 'price': '3243.34'}, {'size': 2144, 'price': '3241.56'}, {'size': 243, 'price': '3239.13'}, {'size': 125, 'price': '3238.41'}, {'size': 348, 'price': '3236.57'}, {'size': 205, 'price': '3235.42'}, {'size': 1, 'price': '3235.41'}, {'size': 43, 'price': '3228.38'}, {'size': 130, 'price': '3227.00'}, {'size': 1198, 'price': '3224.34'}, {'size': 6, 'price': '3222.12'}, {'size': 20, 'price': '3218.14'}, {'size': 81, 'price': '3216.37'}, {'size': 246, 'price': '3215.52'}, {'size': 57, 'price': '3213.16'}, {'size': 6, 'price': '3211.25'}, {'size': 127, 'price': '3207.17'}, {'size': 2251, 'price': '3206.26'}, {'size': 431, 'price': '3203.00'}, {'size': 864, 'price': '3202.49'}, {'size': 124, 'price': '3200.00'}, {'size': 2, 'price': '3194.63'}, {'size': 339, 'price': '3193.41'}, {'size': 6, 'price': '3189.50'}, {'size': 66, 'price': '3189.04'}, {'size': 725, 'price': '3182.08'}, {'size': 475, 'price': '3180.83'}, {'size': 3164, 'price': '3177.03'}, {'size': 30, 'price': '3176.74'}, {'size': 1099, 'price': '3174.87'}, {'size': 644, 'price': '3170.25'}, {'size': 1389, 'price': '3168.20'}, {'size': 12, 'price': '3167.75'}, {'size': 43, 'price': '3162.99'}, {'size': 66, 'price': '3156.06'}, {'size': 394, 'price': '3155.21'}, {'size': 4013, 'price': '3150.01'}, {'size': 31, 'price': '3150.00'}, {'size': 1566, 'price': '3144.33'}, {'size': 123, 'price': '3141.88'}, {'size': 159, 'price': '3141.25'}, {'size': 16, 'price': '3140.10'}, {'size': 384, 'price': '3139.38'}, {'size': 3528, 'price': '3137.66'}, {'size': 486, 'price': '3137.18'}, {'size': 221, 'price': '3131.87'}, {'size': 5207, 'price': '3130.72'}, {'size': 4558, 'price': '3130.51'}, {'size': 12, 'price': '3124.25'}, {'size': 260, 'price': '3120.52'}, {'size': 2084, 'price': '3119.40'}, {'size': 1400, 'price': '3115.24'}, {'size': 3895, 'price': '3112.34'}, {'size': 954, 'price': '3111.77'}, {'size': 937, 'price': '3108.75'}, {'size': 408, 'price': '3107.44'}, {'size': 6, 'price': '3102.50'}, {'size': 13, 'price': '3100.74'}, {'size': 6, 'price': '3100.00'}, {'size': 1210, 'price': '3099.71'}, {'size': 266, 'price': '3098.67'}, {'size': 154, 'price': '3098.42'}, {'size': 229, 'price': '3097.22'}, {'size': 3049, 'price': '3096.15'}, {'size': 793, 'price': '3091.20'}, {'size': 295, 'price': '3087.83'}, {'size': 12, 'price': '3080.75'}, {'size': 117, 'price': '3076.96'}, {'size': 244, 'price': '3074.00'}, {'size': 93, 'price': '3073.72'}, {'size': 228, 'price': '3070.70'}, {'size': 1034, 'price': '3070.29'}, {'size': 6, 'price': '3069.87'}, {'size': 1636, 'price': '3060.66'}, {'size': 15, 'price': '3060.00'}, {'size': 1132, 'price': '3059.03'}, {'size': 32, 'price': '3056.08'}, {'size': 16026, 'price': '3055.08'}, {'size': 50, 'price': '3054.07'}, {'size': 20, 'price': '3050.00'}, {'size': 3230, 'price': '3048.03'}, {'size': 5235, 'price': '3046.14'}, {'size': 82, 'price': '3044.16'}, {'size': 12, 'price': '3037.25'}, {'size': 101, 'price': '3034.75'}, {'size': 960, 'price': '3032.94'}, {'size': 4601, 'price': '3032.48'}, {'size': 219, 'price': '3030.00'}, {'size': 1135, 'price': '3027.10'}, {'size': 3492, 'price': '3027.00'}, {'size': 6, 'price': '3026.37'}, {'size': 438, 'price': '3025.75'}, {'size': 172, 'price': '3025.74'}, {'size': 293, 'price': '3025.42'}, {'size': 542, 'price': '3021.31'}, {'size': 1275, 'price': '3020.22'}, {'size': 2, 'price': '3020.00'}, {'size': 4041, 'price': '3017.66'}, {'size': 149, 'price': '3017.32'}, {'size': 6, 'price': '3015.50'}, {'size': 317, 'price': '3015.32'}, {'size': 370, 'price': '3014.65'}, {'size': 8380, 'price': '3013.53'}, {'size': 2, 'price': '3006.80'}, {'size': 3737, 'price': '3005.95'}, {'size': 6, 'price': '3004.62'}, {'size': 10, 'price': '3003.42'}, {'size': 184, 'price': '3002.64'}, {'size': 2188, 'price': '3002.36'}, {'size': 157, 'price': '3000.00'}, {'size': 4, 'price': '2994.16'}, {'size': 416, 'price': '2993.91'}, {'size': 6, 'price': '2993.74'}, {'size': 30, 'price': '2990.00'}, {'size': 153, 'price': '2988.28'}, {'size': 10, 'price': '2986.37'}, {'size': 1039, 'price': '2985.58'}, {'size': 6, 'price': '2982.87'}, {'size': 53, 'price': '2982.53'}, {'size': 1323, 'price': '2981.11'}, {'size': 322, 'price': '2979.49'}, {'size': 7598, 'price': '2977.74'}, {'size': 87, 'price': '2975.51'}, {'size': 1309, 'price': '2973.79'}, {'size': 6, 'price': '2971.99'}, {'size': 1, 'price': '2970.00'}, {'size': 1545, 'price': '2969.89'}, {'size': 4273, 'price': '2968.62'}, {'size': 100, 'price': '2966.00'}, {'size': 3232, 'price': '2964.38'}, {'size': 565, 'price': '2964.30'}, {'size': 622, 'price': '2962.69'}, {'size': 702, 'price': '2962.35'}, {'size': 6, 'price': '2961.12'}, {'size': 872, 'price': '2959.69'}, {'size': 953, 'price': '2955.80'}, {'size': 372, 'price': '2951.65'}, {'size': 6, 'price': '2950.24'}, {'size': 115, 'price': '2947.93'}, {'size': 2479, 'price': '2947.44'}, {'size': 1011, 'price': '2945.05'}, {'size': 65, 'price': '2942.83'}, {'size': 4613, 'price': '2937.70'}, {'size': 694, 'price': '2937.65'}, {'size': 157, 'price': '2931.20'}, {'size': 178, 'price': '2929.77'}, {'size': 18, 'price': '2928.49'}, {'size': 1771, 'price': '2923.31'}, {'size': 1, 'price': '2922.29'}, {'size': 362, 'price': '2922.02'}, {'size': 295, 'price': '2919.22'}, {'size': 6, 'price': '2917.62'}, {'size': 1117, 'price': '2915.89'}, {'size': 959, 'price': '2915.10'}, {'size': 1776, 'price': '2915.08'}, {'size': 315, 'price': '2910.35'}, {'size': 254, 'price': '2909.22'}, {'size': 105, 'price': '2908.95'}, {'size': 6285, 'price': '2908.84'}, {'size': 138, 'price': '2908.10'}, {'size': 261, 'price': '2906.83'}, {'size': 6, 'price': '2906.74'}, {'size': 396, 'price': '2902.69'}, {'size': 55, 'price': '2900.00'}, {'size': 1647, 'price': '2898.54'}, {'size': 144, 'price': '2896.62'}, {'size': 6, 'price': '2895.87'}, {'size': 2374, 'price': '2895.70'}, {'size': 438, 'price': '2894.27'}, {'size': 5, 'price': '2888.88'}, {'size': 2435, 'price': '2880.80'}, {'size': 3789, 'price': '2879.81'}, {'size': 6, 'price': '2874.12'}, {'size': 2, 'price': '2870.00'}, {'size': 10, 'price': '2869.00'}, {'size': 200, 'price': '2867.12'}, {'size': 1595, 'price': '2866.95'}, {'size': 15, 'price': '2865.96'}, {'size': 1685, 'price': '2865.58'}, {'size': 2, 'price': '2862.85'}, {'size': 1300, 'price': '2858.77'}, {'size': 16, 'price': '2853.00'}, {'size': 12, 'price': '2852.37'}, {'size': 100, 'price': '2850.00'}, {'size': 2209, 'price': '2844.95'}, {'size': 1485, 'price': '2839.31'}, {'size': 274, 'price': '2837.55'}, {'size': 1949, 'price': '2837.16'}, {'size': 2, 'price': '2830.00'}, {'size': 1, 'price': '2825.55'}, {'size': 3135, 'price': '2821.98'}, {'size': 35, 'price': '2810.00'}, {'size': 8, 'price': '2800.76'}, {'size': 161, 'price': '2800.00'}, {'size': 1, 'price': '2790.77'}, {'size': 341, 'price': '2788.18'}, {'size': 5, 'price': '2777.74'}, {'size': 210, 'price': '2770.48'}, {'size': 3145, 'price': '2762.95'}, {'size': 3828, 'price': '2758.88'}, {'size': 11, 'price': '2750.01'}, {'size': 7, 'price': '2750.00'}, {'size': 3151, 'price': '2746.12'}, {'size': 2609, 'price': '2740.68'}, {'size': 200, 'price': '2735.63'}, {'size': 3, 'price': '2721.00'}, {'size': 1659, 'price': '2714.88'}, {'size': 604, 'price': '2711.82'}, {'size': 27, 'price': '2701.70'}, {'size': 9, 'price': '2701.00'}, {'size': 21, 'price': '2700.00'}, {'size': 822, 'price': '2698.85'}, {'size': 888, 'price': '2694.82'}, {'size': 2810, 'price': '2689.00'}, {'size': 491, 'price': '2674.68'}, {'size': 408, 'price': '2673.95'}, {'size': 18, 'price': '2664.87'}, {'size': 1068, 'price': '2640.00'}, {'size': 351, 'price': '2635.32'}, {'size': 2384, 'price': '2621.73'}, {'size': 146, 'price': '2611.04'}, {'size': 8, 'price': '2610.00'}, {'size': 34, 'price': '2608.59'}, {'size': 2630, 'price': '2607.92'}, {'size': 73, 'price': '2600.00'}, {'size': 5, 'price': '2580.00'}, {'size': 56, 'price': '2573.44'}, {'size': 10, 'price': '2569.00'}, {'size': 442, 'price': '2555.63'}, {'size': 6, 'price': '2555.00'}, {'size': 1592, 'price': '2553.12'}, {'size': 30, 'price': '2550.00'}, {'size': 4304, 'price': '2547.66'}, {'size': 100, 'price': '2545.30'}, {'size': 2641, 'price': '2525.28'}, {'size': 8, 'price': '2505.00'}, {'size': 51, 'price': '2500.00'}, {'size': 4702, 'price': '2498.11'}, {'size': 550, 'price': '2495.04'}, {'size': 6717, 'price': '2484.39'}, {'size': 5511, 'price': '2452.27'}, {'size': 10, 'price': '2450.00'}, {'size': 101, 'price': '2431.35'}, {'size': 3990, 'price': '2412.38'}, {'size': 220, 'price': '2410.81'}, {'size': 9, 'price': '2405.00'}, {'size': 23, 'price': '2401.70'}, {'size': 14, 'price': '2400.00'}, {'size': 4870, 'price': '2382.03'}, {'size': 2854, 'price': '2369.77'}, {'size': 1190, 'price': '2366.86'}, {'size': 5507, 'price': '2356.97'}, {'size': 25, 'price': '2333.00'}, {'size': 679, 'price': '2329.14'}, {'size': 3515, 'price': '2328.69'}, {'size': 1158, 'price': '2323.35'}, {'size': 2454, 'price': '2315.02'}, {'size': 9, 'price': '2310.00'}, {'size': 45, 'price': '2300.00'}, {'size': 200, 'price': '2293.60'}, {'size': 1476, 'price': '2281.82'}, {'size': 958, 'price': '2281.41'}, {'size': 4425, 'price': '2267.21'}, {'size': 5503, 'price': '2262.76'}, {'size': 1394, 'price': '2259.22'}, {'size': 4674, 'price': '2254.50'}, {'size': 3828, 'price': '2251.98'}, {'size': 211, 'price': '2242.13'}, {'size': 8, 'price': '2240.00'}, {'size': 1784, 'price': '2205.85'}, {'size': 4320, 'price': '2205.78'}, {'size': 104, 'price': '2200.65'}, {'size': 1, 'price': '2200.00'}, {'size': 1927, 'price': '2189.96'}, {'size': 5, 'price': '2188.88'}, {'size': 116, 'price': '2179.90'}, {'size': 111, 'price': '2178.86'}, {'size': 1, 'price': '2100.00'}, {'size': 1, 'price': '2096.00'}, {'size': 2240, 'price': '2034.57'}, {'size': 35, 'price': '2000.00'}, {'size': 1, 'price': '1990.12'}, {'size': 158, 'price': '1938.10'}, {'size': 1, 'price': '1900.00'}, {'size': 1, 'price': '1850.00'}, {'size': 2070, 'price': '1817.78'}, {'size': 6, 'price': '1800.00'}, {'size': 1, 'price': '1793.70'}, {'size': 1, 'price': '1750.00'}, {'size': 27, 'price': '1700.00'}, {'size': 1306, 'price': '1656.87'}, {'size': 1, 'price': '1640.50'}, {'size': 50, 'price': '1606.93'}, {'size': 646, 'price': '1578.42'}, {'size': 33, 'price': '1513.05'}, {'size': 8, 'price': '1500.00'}, {'size': 1, 'price': '1486.40'}, {'size': 1, 'price': '1470.00'}, {'size': 794, 'price': '1445.50'}, {'size': 100, 'price': '1420.00'}, {'size': 7009, 'price': '1329.63'}, {'size': 28, 'price': '1225.00'}, {'size': 101, 'price': '1221.32'}, {'size': 20, 'price': '1100.00'}, {'size': 1, 'price': '1090.00'}, {'size': 117, 'price': '1089.09'}, {'size': 1, 'price': '1081.20'}, {'size': 10, 'price': '1050.00'}, {'size': 101, 'price': '971.93'}, {'size': 20, 'price': '950.00'}, {'size': 20, 'price': '910.00'}, {'size': 1, 'price': '900.00'}, {'size': 716, 'price': '872.27'}, {'size': 10, 'price': '860.02'}, {'size': 10, 'price': '810.00'}, {'size': 2, 'price': '800.02'}, {'size': 60, 'price': '780.01'}, {'size': 5857, 'price': '716.59'}, {'size': 50, 'price': '700.00'}, {'size': 1, 'price': '670.00'}, {'size': 1983, 'price': '650.00'}, {'size': 25, 'price': '600.00'}, {'size': 100, 'price': '599.13'}, {'size': 1, 'price': '590.51'}, {'size': 5193, 'price': '543.39'}, {'size': 40, 'price': '510.00'}, {'size': 1, 'price': '439.90'}, {'size': 10, 'price': '435.24'}, {'size': 80, 'price': '435.00'}, {'size': 20, 'price': '430.00'}, {'size': 10, 'price': '411.00'}, {'size': 15, 'price': '405.00'}, {'size': 50, 'price': '401.60'}, {'size': 700, 'price': '390.00'}, {'size': 505, 'price': '385.00'}, {'size': 5, 'price': '380.00'}, {'size': 5, 'price': '375.00'}, {'size': 1005, 'price': '370.00'}, {'size': 5, 'price': '365.00'}, {'size': 5, 'price': '355.00'}, {'size': 1000, 'price': '350.00'}, {'size': 2, 'price': '252.00'}, {'size': 1, 'price': '247.86'}, {'size': 2, 'price': '240.00'}, {'size': 1, 'price': '232.00'}, {'size': 100, 'price': '218.00'}, {'size': 1, 'price': '204.00'}, {'size': 12468, 'price': '200.50'}, {'size': 150, 'price': '181.00'}, {'size': 150, 'price': '151.00'}, {'size': 19801, 'price': '150.00'}, {'size': 218838, 'price': '101.00'}, {'size': 274, 'price': '100.00'}, {'size': 1, 'price': '57.00'}, {'size': 98, 'price': '33.79'}, {'size': 1, 'price': '33.00'}, {'size': 1, 'price': '15.99'}, {'size': 76, 'price': '11.74'}, {'size': 3, 'price': '11.00'}, {'size': 104, 'price': '8.00'}, {'size': 1, 'price': '6.25'}, {'size': 102, 'price': '6.00'}, {'size': 118, 'price': '5.00'}, {'size': 1, 'price': '3.67'}, {'size': 100, 'price': '2.11'}, {'size': 1, 'price': '2.00'}, {'size': 99, 'price': '1.96'}, {'size': 101, 'price': '1.30'}, {'size': 261, 'price': '1.00'}, {'size': 104, 'price': '0.90'}, {'size': 108, 'price': '0.76'}, {'size': 1, 'price': '0.19'}, {'size': 10000, 'price': '0.13'}, {'size': 451, 'price': '0.10'}, {'size': 1, 'price': '0.08'}, {'size': 1, 'price': '0.04'}, {'size': 36400, 'price': '0.02'}, {'size': 96916, 'price': '0.01'}]}}
#2017-09-15 14:15:20.258243 : {'MarketDataSnapshotFullRefresh': {'symbol': 'BTCEUR', 'exchangeStatus': 'working', 'timestamp': 1505502919617, 'ask': [{'size': 520, 'price': '2500.01'}, {'size': 1, 'price': '3234.68'}, {'size': 1, 'price': '3265.49'}, {'size': 1, 'price': '3311.70'}, {'size': 8, 'price': '3400.00'}, {'size': 1, 'price': '3500.00'}, {'size': 1, 'price': '3898.30'}, {'size': 2, 'price': '3898.34'}, {'size': 1, 'price': '4080.00'}, {'size': 1, 'price': '4499.99'}, {'size': 300, 'price': '4500.00'}, {'size': 500, 'price': '5000.00'}, {'size': 1, 'price': '5800.00'}, {'size': 1000, 'price': '6000.00'}, {'size': 1000, 'price': '7000.00'}, {'size': 1000, 'price': '8000.00'}, {'size': 1000, 'price': '9000.00'}], 'snapshotSeqNo': 39171, 'bid': [{'size': 1, 'price': '2005.02'}, {'size': 6, 'price': '2005.01'}, {'size': 48, 'price': '2005.00'}, {'size': 1, 'price': '1945.00'}, {'size': 1, 'price': '1000.01'}, {'size': 68, 'price': '1000.00'}, {'size': 1, 'price': '800.01'}, {'size': 30, 'price': '800.00'}, {'size': 1, 'price': '713.01'}, {'size': 21, 'price': '713.00'}, {'size': 1, 'price': '700.01'}, {'size': 10, 'price': '700.00'}, {'size': 1, 'price': '684.01'}, {'size': 463, 'price': '684.00'}, {'size': 1, 'price': '680.04'}, {'size': 68, 'price': '680.03'}, {'size': 1, 'price': '600.03'}, {'size': 2000, 'price': '600.02'}, {'size': 1, 'price': '526.78'}, {'size': 14, 'price': '526.77'}, {'size': 1, 'price': '502.90'}, {'size': 200, 'price': '502.89'}, {'size': 1, 'price': '502.79'}, {'size': 100, 'price': '502.78'}, {'size': 1, 'price': '500.01'}, {'size': 3, 'price': '500.00'}, {'size': 1, 'price': '407.69'}, {'size': 4, 'price': '407.68'}, {'size': 1, 'price': '350.01'}, {'size': 4000, 'price': '350.00'}, {'size': 1, 'price': '340.01'}, {'size': 1, 'price': '340.00'}, {'size': 1, 'price': '330.01'}, {'size': 10, 'price': '330.00'}, {'size': 1, 'price': '300.01'}, {'size': 3, 'price': '300.00'}, {'size': 1, 'price': '277.65'}, {'size': 1, 'price': '277.64'}, {'size': 1, 'price': '250.01'}, {'size': 6000, 'price': '250.00'}, {'size': 1, 'price': '186.01'}, {'size': 100, 'price': '186.00'}, {'size': 1, 'price': '83.67'}, {'size': 1, 'price': '83.66'}, {'size': 1, 'price': '48.01'}, {'size': 1, 'price': '48.00'}, {'size': 1, 'price': '25.23'}, {'size': 1, 'price': '4.31'}, {'size': 1, 'price': '4.30'}, {'size': 1, 'price': '3.01'}, {'size': 1, 'price': '3.00'}, {'size': 1, 'price': '2.87'}, {'size': 2, 'price': '2.86'}, {'size': 1, 'price': '2.13'}, {'size': 100, 'price': '2.12'}, {'size': 1, 'price': '1.01'}, {'size': 8550, 'price': '1.00'}, {'size': 100, 'price': '0.99'}, {'size': 1, 'price': '0.22'}, {'size': 1, 'price': '0.21'}, {'size': 10000, 'price': '0.13'}, {'size': 106, 'price': '0.10'}, {'size': 231, 'price': '0.05'}]}}
